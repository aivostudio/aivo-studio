<!DOCTYPE html>
<html lang="tr" class="aivoAuthPreload">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <meta name="theme-color" content="#070A14" />
  <title>FiyatlandÄ±rma â€¢ AIVO</title>

  <!-- âœ… FOUC FIX -->
  <style>
    html, body { margin:0; min-height:100%; background:#070A14 !important; color:#e7ecff; }
    body { background:#070A14 !important; }
  </style>

  <!-- ================= CORE (genel tema) ================= -->
  <link rel="stylesheet" href="/index.css?v=1000" />

  <!-- ================= SAYFAYA Ã–ZEL (fiyatlandÄ±rma) ================= -->
  <link rel="stylesheet" href="/pricing.css?v=100" />

  <!-- ================= TOPBAR / DROPDOWN (ALWAYS LAST among CSS) ================= -->
  <link rel="stylesheet" href="/products.dropdown.css?v=101" />

  <!-- ================= MODAL (ALWAYS VERY LAST) ================= -->
  <link rel="stylesheet" href="/auth.modal.css?v=100" />

 <!-- ================= PARTIALS (topbar inject) ================= -->
<script src="/include.partials.js?v=3" defer></script>

<!-- ================= AUTH CORE (login/register/logout + openAuthModal) ================= -->
<!-- âš ï¸ Indexâ€™te Ã§alÄ±ÅŸan sÃ¼rÃ¼mle aynÄ± versiyonu kullan (Ã¶r: 20260115x) -->
<script src="/auth.core.js?v=20260115x" defer></script>

<!-- âœ… AUTO LOGIN (autofill / Enter) â€” SAFE -->
<script src="/auth-state.auto.js?v=20260118a" defer></script>

<!-- ================= AUTH UNIFY (UI + menu + logout) ================= -->
<script src="/auth.unify.fix.js?v=1" defer></script>

<!-- ================= STORE ================= -->
<script src="/store.js?v=20260112" defer></script>
</head>


<body class="page-pricing" style="background:#070A14;">

  <!-- ================= TOPBAR (partial) ================= -->
  <!-- Kurumsal ile aynÄ±: tek kaynak topbar partial -->
  <div data-include="topbar"></div>

  <!-- ================= PAGE ================= -->
  <main class="pricing-main">
    <div class="container">

      <!-- HERO -->
      <section class="pricing-hero">
        <div class="pricing-pill">AI MÃ¼zik, Kapak ve Video Ãœretimi</div>
        <h1 class="pricing-title">FiyatlandÄ±rma</h1>
        <p class="pricing-sub">Ä°htiyacÄ±na gÃ¶re kredi paketini seÃ§.</p>
      </section>

      <!-- PACKS -->
      <section class="pricing-section" id="packs" aria-label="Kredi Paketleri">
        <h2 class="pricing-h2">Kredi Paketleri</h2>
        <p class="pricing-h2sub">Tek seferlik kredi satÄ±n al.</p>

        <div class="pricing-grid">

          <article class="p-card">
            <div class="p-top">
              <div class="p-badge">BaÅŸlangÄ±Ã§</div>
              <div class="p-name">Yeni KullanÄ±cÄ±</div>
              <div class="p-price"><span class="p-amount">199â‚º</span><span class="p-per">/ 25 kredi</span></div>
              <div class="p-metric">Kredi baÅŸÄ±na â‚º7.96</div>
            </div>
            <ul class="p-list">
              <li><span class="ok">âœ“</span> 25 Kredi</li>
              <li><span class="ok">âœ“</span> Temel kalite Ã¼retim</li>
              <li><span class="ok">âœ“</span> Standart hÄ±z</li>
              <li><span class="ok">âœ“</span> Kapak + MÃ¼zik</li>
            </ul>
            <div class="p-bottom">
              <div class="p-perks">
                <span class="perk">ğŸ•’ AnÄ±nda Aktivasyon</span><span class="perk">ğŸ›¡ GÃ¼venli Ã–deme</span>
              </div>
              <button class="p-btn" type="button" data-pack="199">Paketi seÃ§</button>
            </div>
          </article>

          <article class="p-card p-pop">
            <div class="p-popTag">â˜… En PopÃ¼ler</div>
            <div class="p-top">
              <div class="p-badge">Standart</div>
              <div class="p-name">Standart Paket</div>
              <div class="p-price"><span class="p-amount">399â‚º</span><span class="p-per">/ 60 kredi</span></div>
              <div class="p-metric">Kredi baÅŸÄ±na â‚º6.65</div>
            </div>
            <ul class="p-list">
              <li><span class="ok">âœ“</span> 60 Kredi</li>
              <li><span class="ok">âœ“</span> Daha hÄ±zlÄ± Ã¼retim</li>
              <li><span class="ok">âœ“</span> Ã–ncelikli sÄ±ra</li>
              <li><span class="ok">âœ“</span> MÃ¼zik + Kapak</li>
            </ul>
            <div class="p-bottom">
              <div class="p-perks">
                <span class="perk">ğŸ•’ AnÄ±nda Aktivasyon</span><span class="perk">ğŸ›¡ GÃ¼venli Ã–deme</span>
              </div>
              <button class="p-btn" type="button" data-pack="399">Paketi seÃ§</button>
            </div>
          </article>

          <article class="p-card">
            <div class="p-top">
              <div class="p-badge">Pro</div>
              <div class="p-name">YaratÄ±cÄ± Ãœretici</div>
              <div class="p-price"><span class="p-amount">899â‚º</span><span class="p-per">/ 150 kredi</span></div>
              <div class="p-metric">Kredi baÅŸÄ±na â‚º5.99</div>
            </div>
            <ul class="p-list">
              <li><span class="ok">âœ“</span> 150 Kredi</li>
              <li><span class="ok">âœ“</span> Premium kalite</li>
              <li><span class="ok">âœ“</span> Ã–ncelikli destek</li>
              <li><span class="ok">âœ“</span> Ticari kullanÄ±m</li>
              <li><span class="ok">âœ“</span> Kapak + MÃ¼zik + Video</li>
            </ul>
            <div class="p-bottom">
              <div class="p-perks">
                <span class="perk">ğŸ•’ AnÄ±nda Aktivasyon</span><span class="perk">ğŸ›¡ GÃ¼venli Ã–deme</span>
              </div>
              <button class="p-btn" type="button" data-pack="899">Paketi seÃ§</button>
            </div>
          </article>

          <article class="p-card">
            <div class="p-top">
              <div class="p-badge">StÃ¼dyo</div>
              <div class="p-name">StÃ¼dyo / Ajans</div>
              <div class="p-price"><span class="p-amount">2.999â‚º</span><span class="p-per">/ 500 kredi</span></div>
              <div class="p-metric">Kredi baÅŸÄ±na â‚º6.00</div>
            </div>
            <ul class="p-list">
              <li><span class="ok">âœ“</span> 500 Kredi</li>
              <li><span class="ok">âœ“</span> TakÄ±m kullanÄ±mÄ±</li>
              <li><span class="ok">âœ“</span> Ã–zel destek</li>
              <li><span class="ok">âœ“</span> Ticari kullanÄ±m</li>
              <li><span class="ok">âœ“</span> YÃ¼ksek hacimli Ã¼retim</li>
            </ul>
            <div class="p-bottom">
              <div class="p-perks">
                <span class="perk">ğŸ•’ AnÄ±nda Aktivasyon</span><span class="perk">ğŸ›¡ GÃ¼venli Ã–deme</span>
              </div>
              <button class="p-btn" type="button" data-pack="2999">Paketi seÃ§</button>
            </div>
          </article>

        </div>
      </section>

      <!-- âœ… KVKK (TEK, PRICING ONLY) -->
      <section class="kvkk-wrap" id="kvkk" aria-label="KVKK OnayÄ±">
        <div class="kvkk-consent" data-kvkk-scope="pricing">

          <div class="kvkk-note">
            <div class="kvkk-note-title">Bilgilendirme</div>
            <div class="kvkk-note-text">
              Kredi paketleri tek seferliktir. SatÄ±n alma sonrasÄ± krediler hesabÄ±na anÄ±nda tanÄ±mlanÄ±r ve AIVO Studioâ€™da
              mÃ¼zik/kapak/video Ã¼retiminde kullanÄ±lÄ±r.
            </div>
          </div>

          <p class="kvkk-text">
            AIVO tarafÄ±ndan sunulan hizmetler kapsamÄ±nda; kimlik, iletiÅŸim,
            Ã¶deme ve kullanÄ±m bilgilerimin, 6698 sayÄ±lÄ± KiÅŸisel Verilerin KorunmasÄ±
            Kanunu uyarÄ±nca hizmetlerin sunulmasÄ±, sÃ¶zleÅŸme sÃ¼reÃ§lerinin
            yÃ¼rÃ¼tÃ¼lmesi ve yasal yÃ¼kÃ¼mlÃ¼lÃ¼klerin yerine getirilmesi amacÄ±yla
            iÅŸlenebileceÄŸini biliyorum. KiÅŸisel verilerimin iÅŸlenmesine iliÅŸkin
            detaylÄ± bilgilere
            <a href="/kurumsal/gizlilik.html" class="kvkk-link">Gizlilik PolitikasÄ±</a>
            Ã¼zerinden ulaÅŸabileceÄŸimi kabul ediyorum.
          </p>

          <label class="kvkk-row">
            <input type="checkbox" data-kvkk-check />
            <span>KVKK AydÄ±nlatma Metniâ€™ni okudum ve kabul ediyorum.</span>
          </label>

          <p class="kvkk-hint" data-kvkk-hint>
            Devam etmek iÃ§in KVKK onayÄ±nÄ± iÅŸaretlemelisin.
          </p>
        </div>
      </section>

    </div>
  </main>

  <!-- ================= FOOTER ================= -->
  <footer class="aivo-footer" id="footer">
    <div class="aivo-wrap aivo-footer-top">
      <div class="aivo-footer-brand">
        <img src="/aivo-logo.png" alt="AIVO" class="aivo-footer-logo-img" loading="lazy">
        <p>TÃ¼rkÃ§e odaklÄ± AI mÃ¼zik Ã¼retiminde yeni bir standart.</p>
      </div>

      <div class="aivo-footer-col">
        <h4>HÄ±zlÄ± Linkler</h4>
        <a href="/#top">Ana Sayfa</a>
        <a href="/#modules">Ã–zellikler</a>
        <a href="/fiyatlandirma.html">FiyatlandÄ±rma</a>
        <a href="/studio.html" data-auth="required">Dashboard</a>
      </div>

      <div class="aivo-footer-col">
        <h4>Kurumsal</h4>
        <a href="/kurumsal/hakkimizda.html">HakkÄ±mÄ±zda</a>
        <a href="/kurumsal/ozellikler.html">Ã–zellikler</a>
        <a href="/kurumsal/gizlilik.html">Gizlilik PolitikasÄ±</a>
        <a href="/kurumsal/mesafeli-satis.html">Mesafeli SatÄ±ÅŸ SÃ¶zleÅŸmesi</a>
        <a href="/kurumsal/iletisim.html">Ä°letiÅŸim</a>
      </div>

      <div class="aivo-footer-right">
        <div class="aivo-contact">
          <h4>Ä°letiÅŸim</h4>
          <a href="mailto:info@aivo.tr">info@aivo.tr</a>
        </div>
      </div>
    </div>

    <div class="aivo-wrap aivo-footer-bottom">
      <div>Â© 2025 AIVO. TÃ¼m haklarÄ± saklÄ±dÄ±r.</div>
      <div class="aivo-status">Durum: <span class="dot"></span> Aktif</div>
    </div>
  </footer>

  <!-- ================= LOGIN MODAL (INDEX Ä°LE AYNI ÅEMA) ================= -->
  <!-- auth.core.js bu modal ÅŸemasÄ±nÄ± bekler: data-close + #btnAuthSubmit -->
  <div class="login-modal" id="loginModal" aria-hidden="true" data-mode="login">
    <div class="login-backdrop" data-close="1"></div>

    <div class="login-panel" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
      <div class="login-card login-header">
        <button class="login-x" type="button" data-close="1" aria-label="Kapat">Ã—</button>
        <h3 id="loginTitle">Tekrar hoÅŸ geldin ğŸ‘‹</h3>
        <p class="login-desc" id="loginDesc">
          AIVO Studioâ€™ya eriÅŸmek iÃ§in giriÅŸ yap veya Ã¼cretsiz hesap oluÅŸtur.
        </p>
      </div>

      <div class="login-card login-google" id="googleBlock">
        <div class="card-title">HÄ±zlÄ± GiriÅŸ</div>
        <div class="card-sub">Google hesabÄ±nla tek tÄ±kla devam et.</div>
        <button id="btnGoogleLogin" type="button" class="btn-google">Google ile GiriÅŸ Yap</button>
      </div>

      <div class="login-card login-email">
        <div class="card-title" id="authCardTitle">Email ile GiriÅŸ</div>
        <div class="card-sub" id="authCardSub">HesabÄ±na email adresinle giriÅŸ yap.</div>

        <div class="email-row email-row-2">
          <input id="loginEmail" type="email" placeholder="ornek@aivo.tr" autocomplete="email" />
          <input id="loginPass" type="password" placeholder="Åifre" autocomplete="current-password" />
        </div>

        <div class="email-row email-row-2" id="registerExtra" style="display:none; margin-top:10px;">
          <input id="registerName" type="text" placeholder="Ad Soyad" autocomplete="name" />
          <input id="registerPass2" type="password" placeholder="Åifre tekrar" autocomplete="new-password" />
        </div>

        <label class="remember-row" id="kvkkRow" style="display:none; margin-top:10px;">
          <input id="kvkkCheck" type="checkbox" />
          <span>KVKK ve ÅŸartlarÄ± kabul ediyorum</span>
        </label>

        <button
          id="btnAuthSubmit"
          type="button"
          class="btn-primary btn-login-full"
          data-auth-submit
          style="margin-top:10px;"
        >
          GiriÅŸ Yap
        </button>

        <div id="authMsg" class="card-sub" style="display:none; margin-top:10px;"></div>

        <div class="login-card login-footer" id="loginFooter" style="margin-top:10px;">
          <span id="authFooterText">AIVOâ€™da yeni misin?</span>
          <a href="#" id="goRegister" class="link-accent">Ãœcretsiz hesap oluÅŸtur â†’</a>

          <span id="authFooterText2" style="display:none;">Zaten hesabÄ±n var mÄ±?</span>
          <a href="#" id="goLogin" class="link-accent" style="display:none;">GiriÅŸ yap â†’</a>

          <div style="display:flex; justify-content:space-between; margin-top:10px;">
            <label class="remember-row" id="rememberRow">
              <input type="checkbox" id="rememberMe" />
              <span>Beni hatÄ±rla</span>
            </label>
            <a href="/forgot.html" id="forgotPass" class="link-muted">Åifreni mi unuttun?</a>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- ================= INLINE KVKK STYLE (AynÄ±) ================= -->
  <style id="kvkk-style-final">
    html body .kvkk-wrap{
      width: 100%;
      max-width: 1280px;
      margin: 22px auto 44px;
      padding: 0 18px;
      box-sizing: border-box;
      position: relative;
      isolation: isolate;
      transform: translateZ(0);
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
    }
    html body .kvkk-wrap .kvkk-consent{
      width: 100%;
      box-sizing: border-box;
      border: 1px solid rgba(160,120,255,.18);
      background: rgba(10,14,28,.55);
      border-radius: 16px;
      padding: 16px;
      box-shadow:
        0 0 0 1px rgba(120,180,255,.10),
        0 0 22px rgba(120,180,255,.08);
      transition: box-shadow .25s ease, border-color .25s ease, transform .25s ease;
      transform: translateZ(0);
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
    }
    html body .kvkk-note{
      margin: 0 0 12px;
      padding: 12px 14px;
      border-radius: 14px;
      background: rgba(10, 14, 22, .35);
      border: 1px solid rgba(160, 120, 255, .14);
    }
    html body .kvkk-note-title{ font-weight: 700; margin: 0 0 6px; }
    html body .kvkk-note-text{ opacity: .88; line-height: 1.45; }
    html body .kvkk-text{ margin:0 0 10px; line-height:1.45; opacity:.92; }
    html body .kvkk-link{ text-decoration: underline; }
    html body .kvkk-row{ display:flex; gap:10px; align-items:flex-start; margin: 10px 0 6px; }
    html body .kvkk-row input{ margin-top: 3px; }
    html body .kvkk-hint{ margin: 6px 0 0; font-size: 13px; opacity:.90; }
    html body .kvkk-consent.is-ok .kvkk-hint{ display:none; }
    html body .kvkk-consent.needs-attention{
      border-color: rgba(255,120,180,.38);
      box-shadow:
        0 0 0 1px rgba(255,120,180,.20),
        0 0 38px rgba(255,120,180,.16),
        0 0 18px rgba(120,180,255,.10);
      transform: translateY(-1px) translateZ(0);
      animation: kvkkPulse 1.1s ease-in-out 2;
    }
    @keyframes kvkkPulse{
      0%,100%{ transform: translateY(-1px) translateZ(0); filter: brightness(1); }
      50%{ transform: translateY(-2px) translateZ(0); filter: brightness(1.12); }
    }
  </style>

  <!-- âœ… KVKK GATE (packs butonlarÄ± KVKKâ€™sÄ±z Ã§alÄ±ÅŸmaz) -->
  <script>
  (function AIVO_KVKK_GATE_FINAL(){
    if (window.__AIVO_KVKK_GATE_FINAL__) return;
    window.__AIVO_KVKK_GATE_FINAL__ = true;

    function $(sel, root){ return (root||document).querySelector(sel); }

    var scope = document.querySelector('[data-kvkk-scope="pricing"]');
    if (!scope) return;

    var check = $('[data-kvkk-check]', scope);
    var hint  = $('[data-kvkk-hint]', scope);

    function ok(){ return !!(check && check.checked); }

    function scrollToKVKK(){
      var wrap = document.getElementById("kvkk") || scope;
      try { wrap.scrollIntoView({behavior:"smooth", block:"center"}); }
      catch(e){ location.hash = "#kvkk"; }
    }

    function attention(){
      scope.classList.add("needs-attention");
      var row = scope.querySelector(".kvkk-row");
      if (row) {
        row.classList.add("kvkk-row-attn");
        setTimeout(function(){ row.classList.remove("kvkk-row-attn"); }, 2200);
      }
      try { if (check) check.focus({ preventScroll: true }); } catch(e){}
      void scope.offsetWidth;
      setTimeout(function(){ scope.classList.remove("needs-attention"); }, 2200);
    }

    function syncUI(){
      var isOK = ok();
      scope.classList.toggle("is-ok", isOK);
      if (hint) hint.style.display = isOK ? "none" : "block";
    }

    if (check) check.addEventListener("change", function(){
      if (ok()) scope.classList.remove("needs-attention");
      syncUI();
    });

    document.addEventListener("click", function(e){
      var btn = e.target && e.target.closest ? e.target.closest('#packs .p-btn[data-pack]') : null;
      if (!btn) return;

      if (!ok()) {
        e.preventDefault();
        e.stopPropagation();
        if (e.stopImmediatePropagation) e.stopImmediatePropagation();
        if (hint) hint.style.display = "block";
        attention();
        scrollToKVKK();
        return false;
      }
    }, true);

    window.__AIVO_KVKK_OK__ = ok;
    syncUI();
  })();
  </script>

  <!-- âœ… PRICING HUB (tek listener; auth.core + openAuthModal ile uyumlu) -->
  <script>
  (function AIVO_PricingHub_SINGLE(){
    if (window.__AIVO_PRICING_HUB_SINGLE__) return;
    window.__AIVO_PRICING_HUB_SINGLE__ = true;

    function isAuthed(){
      try { return !!(window.__AIVO_SESSION__ && window.__AIVO_SESSION__.ok); } catch(e){}
      if (localStorage.getItem("aivo_logged_in") === "1") return true;
      if (localStorage.getItem("aivo_user_email")) return true;
      return false;
    }

    function getUserEmail(){
      try {
        if (window.__AIVO_SESSION__ && window.__AIVO_SESSION__.ok && window.__AIVO_SESSION__.email) {
          var se = String(window.__AIVO_SESSION__.email).trim();
          if (se) return se;
        }
      } catch(e){}
      var e = (localStorage.getItem("aivo_user_email") || "").trim();
      if (e) return e;

      var um = document.getElementById("umEmail");
      if (um && um.textContent) {
        var t = um.textContent.trim();
        if (t && t.indexOf("@") > -1) return t;
      }
      return "";
    }

    function openAuth(mode){
      // auth.core.js â€œtek otoriteâ€ â€” varsa onu kullan
      if (typeof window.openAuthModal === "function") { window.openAuthModal(mode); return; }
      // fallback
      var modal = document.getElementById("loginModal");
      if (!modal) { location.href = "/login.html"; return; }
      modal.dataset.mode = (mode === "register") ? "register" : "login";
      modal.classList.add("is-open");
      modal.style.display = "block";
      modal.setAttribute("aria-hidden", "false");
    }

    function scrollToPacks(){
      var el = document.getElementById("packs");
      if (el && el.scrollIntoView) el.scrollIntoView({ behavior:"smooth", block:"start" });
      else location.hash = "#packs";
    }

    function setReturnAfterPayment(){
      try { sessionStorage.setItem("aivo_return_after_payment", "/studio.html?page=dashboard"); } catch(e){}
    }

    async function startCheckout(pack){
      if (!pack) { scrollToPacks(); return; }

      var email = getUserEmail();
      if (!email) {
        alert("Hesap e-postasÄ± bulunamadÄ±. LÃ¼tfen Ã§Ä±kÄ±ÅŸ yapÄ±p tekrar giriÅŸ yap.");
        return;
      }

      setReturnAfterPayment();

      try {
        var res = await fetch("/api/stripe/create-checkout-session", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          cache: "no-store",
          body: JSON.stringify({ pack: String(pack), user_email: email })
        });

        var data = null;
        try { data = await res.json(); } catch(e){}

        if (!res.ok) {
          console.error("[AIVO] checkout-session failed:", res.status, data);
          alert("Ã–deme baÅŸlatÄ±lamadÄ±. (checkout-session error)");
          return;
        }

        if (data && data.url) { location.href = data.url; return; }

        console.error("[AIVO] checkout-session missing url:", data);
        alert("Ã–deme baÅŸlatÄ±lamadÄ±. (missing url)");
      } catch (err) {
        console.error("[AIVO] checkout-session exception:", err);
        alert("Ã–deme baÅŸlatÄ±lamadÄ±. (network/exception)");
      }
    }

    document.addEventListener("click", function(e){
      var t = e.target;
      if (!t || !t.closest) return;

      // Top â€œKredi Alâ€ sadece packsâ€™e scroll
      var topBuy = t.closest(".btn-credit-buy, [data-open-pricing]");
      if (topBuy && !t.closest("#packs .p-btn[data-pack]")) {
        e.preventDefault();
        scrollToPacks();
        return;
      }

      // Pack seÃ§im
      var packBtn = t.closest("#packs .p-btn[data-pack]");
      if (!packBtn) return;

      e.preventDefault();
      e.stopPropagation();
      if (e.stopImmediatePropagation) e.stopImmediatePropagation();

      var pack = (packBtn.getAttribute("data-pack") || "").trim();
      if (!pack) return;

      if (typeof window.__AIVO_KVKK_OK__ === "function" && !window.__AIVO_KVKK_OK__()) return;

      if (!isAuthed()) {
        try { sessionStorage.setItem("aivo_after_login", "/fiyatlandirma.html#packs"); } catch(e){}
        try { sessionStorage.setItem("aivo_selected_pack", String(pack)); } catch(e){}
        setReturnAfterPayment();
        openAuth("login");
        return;
      }

      startCheckout(pack);
    }, true);

  })();
  </script>
<script>
(function AIVO_PAGE_AUTH_SINGLE(){
  if (window.__AIVO_PAGE_AUTH_SINGLE__) return;
  window.__AIVO_PAGE_AUTH_SINGLE__ = true;

  const $ = (s)=>document.querySelector(s);

  function setText(sel, val){
    const el = $(sel);
    if (!el) return;
    el.textContent = val;
  }

  function showAuth(ok){
    const g = document.getElementById('authGuest');
    const u = document.getElementById('authUser');
    const c = document.getElementById('topCredits');
    if (g) g.hidden = !!ok;
    if (u) u.hidden = !ok;
    if (c) c.hidden = !ok;
  }

  function compute(user){
    const email = (user && user.email ? String(user.email) : '').trim();
    const name  = (user && (user.name || user.fullName || user.displayName) ? String(user.name || user.fullName || user.displayName) : '').trim();
    const src = (name || email || 'H').trim();
    const ch  = (src[0] ? src[0].toUpperCase() : 'H');
    return { ch, name: (name || 'Hesap'), email: (email || 'â€”') };
  }

  function apply(user){
    const v = compute(user);
    setText('#topUserInitial', v.ch);
    setText('#topUserName', v.name);
    setText('#umAvatar', v.ch);
    setText('#umName', v.name);
    setText('#umEmail', v.email);
  }

  // 6 sn enforce: diÄŸer scriptler sonradan H basarsa geri al
  function enforce(user){
    let i = 0;
    const t = setInterval(()=>{
      i++;
      apply(user);
      if (i >= 40) clearInterval(t);
    }, 150);
  }

  async function run(){
    try{
      const r = await fetch('/api/auth/me', { credentials:'include', cache:'no-store' });
      if (r.status !== 200){
        showAuth(false);
        apply({ name:'Hesap', email:'' });
        return;
      }
      const user = await r.json().catch(()=>({}));
      showAuth(true);
      apply(user);
      enforce(user);
    }catch(e){
      showAuth(false);
      apply({ name:'Hesap', email:'' });
    }
  }

  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', run, { once:true });
  } else {
    run();
  }

  // logout
  document.addEventListener('click', async (e)=>{
    const btn = e.target.closest('[data-action="logout"], #btnLogoutTop, .um-logout');
    if (!btn) return;
    e.preventDefault();
    try{ await fetch('/api/auth/logout', { method:'POST', credentials:'include' }); }catch(_){}
    showAuth(false);
    apply({ name:'Hesap', email:'' });
    location.assign(btn.getAttribute('data-redirect') || '/');
  }, true);
})();
</script>
</body>
</html>
