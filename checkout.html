<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AIVO Checkout</title>

  <!-- Ortak stil (içinde CHECKOUT UI POLISH v1 bloğu var) -->
  <link rel="stylesheet" href="studio.css?v=7" />
</head>

<body>
  <!-- Topnav varsa aynen kalsın. Yoksa sorun değil. -->

  <main class="checkout-page">
    <div class="checkout-shell">
      <section class="checkout-card" aria-label="Checkout">
        <h1 class="checkout-title">Checkout</h1>
        <p class="checkout-desc">Seçtiğin paketi doğrula ve ödemeyi tamamla.</p>

        <div class="checkout-summary" aria-label="Sipariş özeti">
          <div class="checkout-row">
            <div class="checkout-k">Paket</div>
            <div class="checkout-v" id="checkoutPlanText">—</div>
          </div>

          <div class="checkout-row">
            <div class="checkout-k">Tutar</div>
            <div class="checkout-v checkout-price" id="checkoutPriceText">—</div>
          </div>
        </div>

        <div class="checkout-actions" role="group" aria-label="Checkout işlemleri">
          <button class="btn btn-secondary" type="button" data-checkout-back>
            Geri
          </button>

          <button class="btn btn-primary" type="button" data-checkout-pay>
            <span class="btn-spinner" hidden></span>
            <span class="btn-text">Ödemeyi Başlat</span>
          </button>
        </div>
      </section>
    </div>
  </main>

  <script>
    (function () {
      function qs(sel, root) { return (root || document).querySelector(sel); }

      // URL parametreleri
      var params = new URLSearchParams(window.location.search);
      var plan = params.get('plan') || 'Standart Paket';
      var price = params.get('price') || '—';

      // UI bas
      var planEl = qs('#checkoutPlanText');
      var priceEl = qs('#checkoutPriceText');
      if (planEl) planEl.textContent = plan;
      if (priceEl) priceEl.textContent = price;

      // Back
      document.addEventListener('click', function (e) {
        var backBtn = e.target.closest ? e.target.closest('[data-checkout-back]') : null;
        if (!backBtn) return;
        window.history.back();
      });

      // Pay (A şıkkı: demo yazısı yok, sadece loading + çift tık koruma)
      document.addEventListener('click', function (e) {
        var payBtn = e.target.closest ? e.target.closest('[data-checkout-pay]') : null;
        if (!payBtn) return;

        if (payBtn.classList.contains('is-loading') || window.__checkoutPayBusy) return;
        window.__checkoutPayBusy = true;

        var spinner = qs('.btn-spinner', payBtn);
        var textEl = qs('.btn-text', payBtn);
        var oldText = textEl ? textEl.textContent : 'Ödemeyi Başlat';

        payBtn.classList.add('is-loading');
        payBtn.disabled = true;
        if (spinner) spinner.hidden = false;
        if (textEl) textEl.textContent = 'İşleniyor...';

        // Şimdilik gerçek ödeme yok (UI stabilizasyon)
        setTimeout(function () {
          if (spinner) spinner.hidden = true;
          if (textEl) textEl.textContent = oldText;
          payBtn.disabled = false;
          payBtn.classList.remove('is-loading');
          window.__checkoutPayBusy = false;

          console.log('[CHECKOUT] pay clicked (UI polish mode)');
        }, 900);
      });
    })();
  </script>
</body>
</html>
