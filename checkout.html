<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>AIVO Checkout</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark" />

  <link rel="stylesheet" href="/studio.css" />
</head>

<body>

<main style="padding:40px; color:#fff;">
  <h1>Checkout</h1>
  <p>Seçtiğin paketi doğrula ve ödemeyi tamamla.</p>

  <p><b>Paket:</b> Standart Paket</p>
  <p><b>Tutar:</b> 399 ₺</p>

  <button id="payBtn">Güvenli Ödeme</button>

  <p id="msg" style="margin-top:10px;"></p>

  <div id="iframeWrap" style="display:none; margin-top:20px;">
    <iframe
      name="paytriframe"
      style="width:100%; height:650px; border:none; border-radius:12px;"
    ></iframe>
  </div>
</main>

<script>
document.getElementById("payBtn").addEventListener("click", async () => {
  const msg = document.getElementById("msg");
  msg.textContent = "Ödeme hazırlanıyor...";

  const res = await fetch("/api/paytr/init", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      email: "test@aivo.tr",
      plan: "Standart Paket",
      amount: 399
    })
  });

  const data = await res.json();

  if (data.status !== "success") {
    msg.textContent = JSON.stringify(data);
    return;
  }

  const form = document.createElement("form");
  form.method = "POST";
  form.action = "https://www.paytr.com/odeme";
  form.target = "paytriframe";

  Object.entries(data.form).forEach(([k, v]) => {
    const i = document.createElement("input");
    i.type = "hidden";
    i.name = k;
    i.value = v;
    form.appendChild(i);
  });

  document.body.appendChild(form);

  document.getElementById("iframeWrap").style.display = "block";
  form.submit();
});
</script>

</body>
</html>
