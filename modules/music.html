<section class="main-panel musicPage" data-module="music">

  <!-- ================= MUSIC MODULE ================= -->

  <!-- ****** GELENEKSEL VIEW ****** -->
  <div class="music-view" data-music-view="geleneksel">

    <!-- HEADER -->
    <div class="panel-header">
      <div class="page-head">
        <div class="page-head__box">
          <h1 class="page-head__title">AI MÃ¼zik Ãœret</h1>
          <p class="page-head__sub">
            Ritim, vokal, mood ve tÃ¼r seÃ§ â€” AIVO ÅŸarkÄ±yÄ± senin iÃ§in oluÅŸtursun.
          </p>
        </div>
      </div>
    </div>

    <!-- Ã‡ALIÅMA MODU -->
    <div class="card" data-ui="workmode">
      <div class="card-header">
        <div>
          <div class="card-title">Ã‡alÄ±ÅŸma Modu</div>
          <div class="card-subtitle">
            HÄ±zlÄ± baÅŸlangÄ±Ã§ iÃ§in Basit Mod, detaylÄ± kontrol iÃ§in GeliÅŸmiÅŸ Mod.
          </div>
        </div>
      </div>

      <div class="card-body">
        <div class="mode-toggle">
          <button class="mode-btn" type="button" data-mode-button="basic">
            Basit Mod
          </button>
          <button class="mode-btn" type="button" data-mode-button="advanced">
            GeliÅŸmiÅŸ Mod <span class="mode-star">âœ¦</span>
          </button>
        </div>
      </div>
    </div>

    <!-- FORM -->
    <div class="card">
      <div class="form-grid">

        <div class="form-field full">
          <label for="songName">ÅarkÄ± AdÄ±</label>
          <input type="text" id="songName"
                 placeholder="Ã–rn: KÃ¼l BahÃ§esi, Midnight Drive..." />
        </div>

        <div class="form-field full">
          <label for="lyrics">ÅarkÄ± SÃ¶zleri (isteÄŸe baÄŸlÄ±)</label>
          <textarea id="lyrics" rows="3"
            placeholder="ÅarkÄ± sÃ¶zlerini buraya yazÄ±n veya boÅŸ bÄ±rakÄ±n..."></textarea>
        </div>

        <div class="form-field full">
          <label for="prompt">Ek AÃ§Ä±klama / Prompt</label>
          <textarea id="prompt" rows="3"
            placeholder="MÃ¼zikte Ã¶zellikle vurgulamak istediÄŸin detaylarÄ± yaz..."></textarea>
        </div>

        <div class="form-field full">
          <label for="songDesc">ÅarkÄ± AÃ§Ä±klamasÄ± (max 200 karakter)</label>
          <textarea id="songDesc" maxlength="200" rows="2"
            placeholder="ÅarkÄ±nÄ±n genel havasÄ±nÄ± kÄ±saca anlat..."></textarea>
        </div>

        <div class="form-field full">
          <label>Referans Ses YÃ¼kle (opsiyonel)</label>

          <input type="file" id="refAudio" accept=".mp3,.wav,.m4a" hidden />

          <label class="upload-box" for="refAudio">
            <div>
              <strong>Ses dosyasÄ± seÃ§ veya sÃ¼rÃ¼kleyip bÄ±rak</strong><br />
              <span class="upload-hint">MP3, WAV, M4A â€” maksimum 10MB</span>
            </div>
          </label>
        </div>

        <div class="form-field half" data-visible-in="advanced">
          <label for="mood">Ruh Hali (Mood)</label>
          <select id="mood">
            <option value="">Ruh halini seÃ§</option>
            <option>Enerjik</option>
            <option>HÃ¼zÃ¼nlÃ¼</option>
            <option>Romantik</option>
            <option>Sakin</option>
            <option>Epik</option>
          </select>
        </div>

        <div class="form-field half" data-visible-in="advanced">
          <label for="vocalType">Vokal Tipi</label>
          <select id="vocalType">
            <option value="">Vokal tipini seÃ§</option>
            <option>Erkek Vokal (AI)</option>
            <option>KadÄ±n Vokal (AI)</option>
            <option>Soft / Ã‡ocuk Vokal (AI)</option>
            <option>EnstrÃ¼mantal (Vokalsiz)</option>
          </select>
        </div>

        <div class="form-field half">
          <label for="genre">TÃ¼r (Genre)</label>
          <select id="genre">
            <option value="">TÃ¼r seÃ§in</option>
            <option>TÃ¼rkÃ§e Pop</option>
            <option>Anadolu Pop</option>
            <option>Arabesk</option>
            <option>Deep House</option>
            <option>Lo-fi</option>
            <option>Trap</option>
          </select>
        </div>

        <div class="form-field half">
          <label for="bpm">Tempo (BPM)</label>
          <input type="number" id="bpm" placeholder="Ã–rn: 128" />
        </div>

      </div>
    </div>

    <!-- GENERATE -->
    <div class="card">
      <div class="form-field full">
        <button class="primary-btn full-width"
                id="musicGenerateBtn"
                type="button"
                data-generate="music"
                data-credit-cost="5">
          ğŸµ MÃ¼zik Ãœret <span class="credit-mini">(5 Kredi)</span>
        </button>
      </div>
    </div>

  </div>
  <!-- ****** /GELENEKSEL VIEW ****** -->


  <!-- ****** SES KAYDI VIEW ****** -->
  <div class="music-view" data-music-view="ses-kaydi" id="musicViewSesKaydi">

    <div class="card record-main-card">

      <div class="record-circle" role="button" aria-label="KayÄ±t">
        <span class="record-icon">ğŸ™ï¸</span>
      </div>

      <div class="ses-button-under-circle">
        <button class="primary-btn record-btn" type="button">
          âº KaydÄ± BaÅŸlat
        </button>
      </div>

      <div class="record-wave" id="recordWave" aria-hidden="true">
        <div class="wave-bar" style="--i:1"></div>
        <div class="wave-bar" style="--i:2"></div>
        <div class="wave-bar" style="--i:3"></div>
        <div class="wave-bar" style="--i:4"></div>
        <div class="wave-bar" style="--i:5"></div>
        <div class="wave-bar" style="--i:6"></div>
        <div class="wave-bar" style="--i:7"></div>
        <div class="wave-bar" style="--i:8"></div>
        <div class="wave-bar" style="--i:9"></div>
        <div class="wave-bar" style="--i:10"></div>
        <div class="wave-bar" style="--i:11"></div>
        <div class="wave-bar" style="--i:12"></div>
      </div>

      <div class="record-bottom-shell">
        <div class="record-info-grid">

          <div class="record-info-card">
            <h3 class="record-info-title">Ses Kaydetmeye BaÅŸlayÄ±n</h3>
            <p class="record-info-text">
              Butona tÄ±klayarak kayÄ±t modunu aÃ§. Ä°lk kullanÄ±mda tarayÄ±cÄ±
              mikrofon izni isteyebilir.
            </p>
          </div>

          <div class="record-info-card is-upload">
            <h3 class="record-info-title">Ses DosyasÄ± YÃ¼kle</h3>

            <input type="file" id="recordMp3Input" accept=".mp3,.wav,.m4a" hidden />

            <label class="upload-box record-upload-box" for="recordMp3Input">
              <strong>Ses dosyasÄ± seÃ§</strong>
              <span>veya sÃ¼rÃ¼kleyip bÄ±rak</span>
            </label>
          </div>

        </div>
      </div>

    </div>
  </div>
  <!-- ****** /SES KAYDI VIEW ****** -->

</section>
<script>
window.switchMusicView = function switchMusicView(tab) {
  // tab normalize
  const t = String(tab || '')
    .toLowerCase()
    .trim()
    .replaceAll('_','-')
    .replaceAll(' ','-');

  // âš ï¸ scope'lu selector (KRÄ°TÄ°K)
  const root       = document.querySelector('.musicPage');
  const geleneksel = root?.querySelector('[data-music-view="geleneksel"]');
  const sesKaydi   = root?.querySelector('[data-music-view="ses-kaydi"]');

  if (!geleneksel || !sesKaydi) {
    console.warn('[switchMusicView] view bulunamadÄ±', {
      root: !!root, geleneksel: !!geleneksel, sesKaydi: !!sesKaydi, tab
    });
    return;
  }

  // Ã¶nce ikisini de kapat (atomik)
  geleneksel.style.display = 'none';
  sesKaydi.style.display   = 'none';

  // hedef seÃ§imi
  const isSesKaydi =
    t === 'ses-kaydi' ||
    t.includes('ses') ||
    t.includes('kaydi') ||
    t.includes('record');

  (isSesKaydi ? sesKaydi : geleneksel).style.display = 'block';

  // debug (istersen sonra sil)
  console.log('[switchMusicView]', { tab, normalized: t, isSesKaydi });
};
</script>
