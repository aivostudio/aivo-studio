<section class="main-panel" data-module="video">

  <!-- ================= VIDEO MODULE ================= -->

  <!-- ****** AI VIDEO ÃœRET (ROOT) ****** -->
  <div class="video-view is-active" data-video-view="root">

    <!-- HEADER -->
    <div class="panel-header">
      <div class="page-head">
        <div class="page-head__box">
          <h1 class="page-head__title">AI Video Ãœret</h1>
          <p class="page-head__sub">
            YazÄ±dan veya gÃ¶rselden sinematik videolar oluÅŸtur.
          </p>
        </div>
      </div>
    </div>

    <!-- ================= ORTAK VÄ°DEO AYARLARI ================= -->
    <div class="card video-common-settings">
      <div class="form-grid">

        <div class="form-field half">
          <label for="videoDuration">SÃ¼re</label>
          <select id="videoDuration">
            <option value="4">4 Saniye</option>
            <option value="6">6 Saniye</option>
            <option value="8" selected>8 Saniye</option>
          </select>
        </div>

        <div class="form-field half">
          <label for="videoResolution">Ã‡Ã¶zÃ¼nÃ¼rlÃ¼k</label>
          <select id="videoResolution">
            <option value="720">720p HD</option>
            <option value="1080">1080p Full HD</option>
          </select>
        </div>

        <div class="form-field full">
          <label for="videoRatio">En / Boy OranÄ±</label>
          <select id="videoRatio">
            <option value="16:9">GeniÅŸ (16:9)</option>
            <option value="9:16">Dikey (9:16)</option>
            <option value="1:1">Kare (1:1)</option>
          </select>
        </div>

      </div>
    </div>
    <!-- =============== /ORTAK VÄ°DEO AYARLARI ================= -->

    <!-- ================= SES ÃœRETÄ°MÄ° ================= -->
    <div class="audio-toggle-card">
      <div class="audio-toggle-left">
        <div class="audio-icon">ğŸ”Š</div>
        <div class="audio-text">
          <div class="audio-title">Ses Ãœretimi</div>
          <div class="audio-desc">KapalÄ±ysa %33 daha az kredi harcar</div>
        </div>
      </div>

      <label class="audio-switch">
        <input type="checkbox" id="audioEnabled" checked />
        <span class="audio-slider"></span>
      </label>
    </div>
    <!-- =============== /SES ÃœRETÄ°MÄ° ================= -->

    <!-- ================= VÄ°DEO TABLARI ================= -->
    <div class="video-tabs">
      <button class="video-tab is-active" type="button" data-video-tab="text">
        YazÄ±dan Video
      </button>
      <button class="video-tab" type="button" data-video-tab="image">
        Resimden Video
      </button>
    </div>

    <!-- ================= TEXT â†’ VIDEO ================= -->
    <div class="video-subview is-active" data-video-subview="text">
      <div class="card">

        <div class="card-header">
          <div>
            <div class="card-title">Video AÃ§Ä±klamasÄ±</div>
            <div class="card-subtitle">Max 1000 karakter</div>
          </div>
          <div class="badge-beta">10 Kredi</div>
        </div>

        <div class="video-prompt-wrapper">
          <div class="video-prompt-tip">
            Ã–rn: Gece neon ÅŸehir, mor-mavi tonlar, yavaÅŸ kamera hareketi,
            hafif sis, sinematik.
          </div>

          <textarea id="videoPrompt"
                    maxlength="1000"
                    placeholder="Video aÃ§Ä±klamasÄ± (max 1000 karakter)..."></textarea>

          <div class="video-prompt-counter" id="videoPromptCounter">
            0 / 1000
          </div>
        </div>

        <button class="primary-btn big-video-btn full-width"
                id="videoGenerateTextBtn"
                type="button"
                data-generate="video"
                data-credit-cost="10">
          ğŸ¬ Video OluÅŸtur (10 Kredi)
        </button>

      </div>
    </div>
    <!-- =============== /TEXT â†’ VIDEO ================= -->

   <!-- ================= IMAGE â†’ VIDEO ================= -->
<div class="video-subview" data-video-subview="image">
  <div class="card">

    <div class="card-header">
      <div>
        <div class="card-title">Resim YÃ¼kle</div>
        <div class="card-subtitle">PNG / JPG â€“ Max 10MB</div>
      </div>
      <div class="badge-beta">10 Kredi</div>
    </div>

    <div class="upload-box upload-box--file">
      <!-- TÃ¼m kutuyu kaplayan gÃ¶rÃ¼nmez input -->
      <input type="file" id="videoImageInput" accept="image/*" />

      <strong>Resim seÃ§ veya sÃ¼rÃ¼kleyip bÄ±rak</strong>
      <p class="record-upload-hint">PNG / JPG â€¢ Maks 10MB</p>

      <!-- UX feedback alanÄ± -->
      <div class="upload-feedback" id="videoImageFeedback" style="display:none;">
        <div class="upload-filename" id="videoImageName"></div>

        <div class="upload-bar">
          <div class="upload-bar__fill" id="videoImageBar"></div>
        </div>

        <div class="upload-percent" id="videoImagePct">0%</div>
      </div>
    </div>

    <div class="video-prompt-wrapper">
      <div class="video-prompt-tip">
        Ã–rn: Kamera yaklaÅŸsÄ±n, hafif parallax ve Ä±ÅŸÄ±k geÃ§iÅŸleri olsun.
      </div>

      <textarea id="videoImagePrompt"
                maxlength="1000"
                placeholder="Resim nasÄ±l canlansÄ±n? (opsiyonel)"></textarea>

     <div class="video-prompt-counter" id="videoImagePromptCounter">
  0 / 1000
</div>


    <button class="primary-btn big-video-btn full-width"
            id="videoGenerateImageBtn"
            type="button"
            data-generate="video"
            data-credit-cost="10">
      ğŸ Video OluÅŸtur (10 Kredi)
    </button>

  </div>
</div>
<!-- =============== /IMAGE â†’ VIDEO ================= -->


  </div>
<script>
(function () {
  function qs(sel, root = document) {
    return root.querySelector(sel);
  }

  async function createVideoFromText() {
    const prompt = qs("#videoPrompt")?.value?.trim();
    if (!prompt) {
      alert("LÃ¼tfen video aÃ§Ä±klamasÄ± yaz.");
      return;
    }

    const payload = {
      app: "video",
      mode: "text",
      prompt,
      duration: Number(qs("#videoDuration")?.value || 8),
      resolution: Number(qs("#videoResolution")?.value || 720),
      ratio: qs("#videoRatio")?.value || "16:9",
      audio: !!qs("#audioEnabled")?.checked
    };

    try {
      const res = await fetch("/api/providers/runway/video/create", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const json = await res.json();
      if (!res.ok) throw json;

      const job = json.job || json;

      if (window.AIVO_JOBS && typeof window.AIVO_JOBS.upsert === "function") {
        window.AIVO_JOBS.upsert(job);
      }

      console.log("[video] job created", job);
    } catch (err) {
      console.error("[video] create failed", err);
      alert("Video oluÅŸturulamadÄ±. Console loguna bak.");
    }
  }

  async function createVideoFromImage() {
    const fileInput = qs("#videoImageInput");
    const file = fileInput?.files?.[0];

    if (!file) {
      alert("LÃ¼tfen bir resim seÃ§.");
      return;
    }

    const prompt = qs("#videoImagePrompt")?.value?.trim() || "";

    const payload = new FormData();
    payload.append("app", "video");
    payload.append("mode", "image");
    payload.append("image", file);
    payload.append("prompt", prompt);
    payload.append("duration", String(Number(qs("#videoDuration")?.value || 8)));
    payload.append("resolution", String(Number(qs("#videoResolution")?.value || 720)));
    payload.append("ratio", qs("#videoRatio")?.value || "16:9");
    payload.append("audio", String(!!qs("#audioEnabled")?.checked));

    try {
      const res = await fetch("/api/providers/runway/video/create", {
        method: "POST",
        body: payload
      });

      const json = await res.json();
      if (!res.ok) throw json;

      const job = json.job || json;

      if (window.AIVO_JOBS && typeof window.AIVO_JOBS.upsert === "function") {
        window.AIVO_JOBS.upsert(job);
      }

      console.log("[video] image job created", job);
    } catch (err) {
      console.error("[video] image create failed", err);
      alert("Resimden video oluÅŸturulamadÄ±. Console loguna bak.");
    }
  }
  // IMAGE input UX feedback (fake progress + filename)
  const imgInput = qs("#videoImageInput");
  const fb = qs("#videoImageFeedback");
  const nm = qs("#videoImageName");
  const bar = qs("#videoImageBar");
  const pct = qs("#videoImagePct");

  if (imgInput) {
    imgInput.addEventListener("change", () => {
      const f = imgInput.files?.[0];
      if (!f) return;

      if (fb) fb.style.display = "";
      if (nm) nm.textContent = `SeÃ§ildi: ${f.name} (${Math.round(f.size/1024/1024*10)/10}MB)`;

      // fake progress
      let p = 0;
      if (bar) bar.style.width = "0%";
      if (pct) pct.textContent = "0%";

      const t = setInterval(() => {
        p += Math.max(3, Math.round((100 - p) * 0.18));
        if (p >= 100) {
          p = 100;
          clearInterval(t);
        }
        if (bar) bar.style.width = p + "%";
        if (pct) pct.textContent = p + "%";
      }, 90);
    });
  }

  document.addEventListener("click", function (e) {
    const btnText = e.target.closest("#videoGenerateTextBtn");
    if (btnText) {
      e.preventDefault();
      createVideoFromText();
      return;
    }

    const btnImg = e.target.closest("#videoGenerateImageBtn");
    if (btnImg) {
      e.preventDefault();
      createVideoFromImage();
      return;
    }
  });
})();
</script>



</section>

